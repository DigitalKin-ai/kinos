{% extends "base.html" %}

{% block title %}Parallagon Web{% endblock %}

{% block head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@6.5.95/css/materialdesignicons.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
{% endblock %}

{% block content %}
<div id="app">
    <div class="main-container">
        <!-- Header -->
        <div class="header">
            <div class="logo">⚫ Parallagon</div>
            <div class="controls">
                <button class="btn-start" @click="startAgents" :disabled="running">
                    ▶ Start
                </button>
                <button class="btn-stop" @click="stopAgents" :disabled="!running">
                    ■ Stop
                </button>
                <button class="btn-reset" @click="resetFiles" :disabled="running">
                    ↺ Reset
                </button>
                <span class="status" :class="{ 'status-running': running }">
                    ● ${ running ? 'Running' : 'Stopped' }
                </span>
            </div>
        </div>

        <!-- Main content with sidebar tabs -->
        <div class="content-container">
            <!-- Left sidebar tabs -->
            <div class="sidebar">
                <div class="tab-item" 
                     v-for="tab in tabs" 
                     :key="tab.id"
                     :class="{ active: activeTab === tab.id }"
                     @click="setActiveTab(tab.id)">
                    <i :class="tab.icon"></i>
                    <span>${ tab.name }</span>
                    <button v-if="tab.id === 'demande'" 
                            class="btn-save"
                            @click.stop="saveDemande"
                            :disabled="!demandeChanged">
                        Save
                    </button>
                </div>
                
                <!-- Logs controls -->
                <div class="logs-controls" v-if="activeTab === 'logs'">
                    <button class="btn-export" @click="exportLogs">Export</button>
                    <button class="btn-clear" @click="clearLogs">Clear</button>
                </div>
            </div>

            <!-- Content area -->
            <div class="content-area">
                <!-- Demande content -->
                <textarea v-if="activeTab === 'demande'"
                         v-model="content.demande"
                         @input="onDemandeInput"
                         class="demande-input"></textarea>

                <!-- Agent panels content -->
                <pre v-else-if="activeTab !== 'logs'"
                     class="agent-content"
                     v-html="highlightContent(activeTab)"></pre>

                <!-- Logs content -->
                <div v-else class="logs-content">
                    <div v-for="log in logs"
                         :key="log.id"
                         class="log-entry"
                         :class="log.level">
                        <span class="log-timestamp">${log.timestamp}</span>
                        <span class="log-message">${log.message}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% raw %}
    <!-- Header -->
    <header class="parallagon-header">
        <div class="flex items-center gap-4">
            <h1 class="parallagon-title">
                <span class="status-dot" :class="running ? 'running' : 'stopped'"></span>
                Parallagon
            </h1>
            <div class="connection-status" :class="connectionStatus">
                {{ connectionStatus }}
            </div>
        </div>
        <div class="control-buttons">
            <button class="btn btn-start" 
                    @click="startAgents" 
                    :disabled="running">
                <i class="mdi mdi-play"></i>
                Start
            </button>
            <button class="btn btn-stop" 
                    @click="stopAgents" 
                    :disabled="!running">
                <i class="mdi mdi-stop"></i>
                Stop
            </button>
            <div class="status-indicator">
                <span>${ running ? "Running" : "Stopped" }</span>
            </div>
        </div>
    </header>

    <!-- Notifications -->
    <div class="notifications-container">
        <transition-group name="notification">
            <div v-for="notification in notifications"
                 :key="notification.id"
                 class="notification"
                 :class="notification.type">
                <i :class="notificationIcon(notification.type)"></i>
                <span class="notification-message">${notification.message}</span>
            </div>
        </transition-group>
    </div>

    <!-- Main content -->
    <div class="container mx-auto p-4">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <!-- Demande Panel -->
            <div class="panel col-span-2">
                <div class="panel-header">
                    <h2 class="panel-title">
                        <i class="mdi mdi-file-document-outline mr-2"></i>Demande
                    </h2>
                    <div class="panel-controls">
                        <button @click="saveDemande" 
                                class="btn-save"
                                :disabled="!demandeChanged">
                            <i class="mdi mdi-content-save mr-1"></i> Save
                        </button>
                    </div>
                </div>
                <div class="panel-content">
                    <textarea v-model="content.demande" 
                             @input="onDemandeInput"
                             class="content-area"></textarea>
                </div>
            </div>

            <!-- Agent Panels -->
            <template v-for="panel in panels" :key="panel.id">
                <div class="panel" :class="{'updating': panel.updating}">
                    <div class="panel-header">
                        <h2 class="panel-title">
                            <i :class="panel.icon" class="mr-2"></i>
                            ${panel.name}
                        </h2>
                        <div class="panel-status">
                            <span v-if="panel.updating" class="updating-badge">
                                <i class="mdi mdi-sync spin mr-1"></i> Updating
                            </span>
                        </div>
                    </div>
                    <div class="panel-content">
                        <pre class="content-display" v-html="highlightContent(panel.id)"></pre>
                    </div>
                </div>
            </template>
        </div>

        <!-- Logs Panel -->
        <div class="panel logs-panel mt-4">
            <div class="panel-header">
                <h2 class="panel-title">
                    <i class="mdi mdi-console-line mr-2"></i>Suivi Mission
                </h2>
                <div class="panel-controls">
                    <button @click="exportLogs" class="btn-export">
                        <i class="mdi mdi-download mr-1"></i> Export
                    </button>
                    <button @click="clearLogs" class="btn-clear">
                        <i class="mdi mdi-trash-can mr-1"></i> Clear
                    </button>
                </div>
            </div>
            <div class="panel-content logs-content">
                <div v-for="log in logs" 
                     :key="log.id" 
                     class="log-entry"
                     :class="log.level">
                    <span class="log-timestamp">${ log.timestamp }</span>
                    <span class="log-message">${ log.message }</span>
                </div>
            </div>
        </div>
    </div>
    {% endraw %}
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='app.js') }}"></script>
{% endblock %}
